<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Calculadora</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="card">
    <h1>Calculadora</h1>
    <form id="calcForm">

        <!-- Tipo de entrada — refleja el patrón Adapter en el front -->
        <div class="field">
            <label>Modo de entrada</label>
            <select id="inputMode" onchange="toggleInputMode()">
                <option value="separate">Dos campos separados</option>
                <option value="comma">Texto separado por coma (ej: 3.5,2)</option>
            </select>
        </div>

        <!-- Modo: dos campos (StringToDoubleAdapter / campos individuales) -->
        <div id="separateInputs">
            <div class="field">
                <label>Primer número</label>
                <input type="number" id="fieldA" step="any">
            </div>
            <div class="field">
                <label>Segundo número</label>
                <input type="number" id="fieldB" step="any">
            </div>
        </div>

        <!-- Modo: texto con coma (StringToDoubleAdapter) -->
        <div id="commaInput" style="display:none">
            <div class="field">
                <label>Operandos (ej: 3.5,2)</label>
                <input type="text" id="fieldComma" placeholder="3.5,2">
            </div>
        </div>

        <!-- Operaciones — incluyendo las nuevas -->
        <div class="field">
            <label>Operación</label>
            <select name="operation" id="operation">
                <option value="add">Suma</option>
                <option value="subtract">Resta</option>
                <option value="multiplication">Multiplicación</option>
                <option value="division">División</option>
                <option value="legacy-add">Suma (legacy)</option>
            </select>
        </div>

        <button type="submit">Calcular</button>
    </form>
    <div id="output"></div>
</div>

<script>
    // Alterna la vista según el modo de entrada elegido
    function toggleInputMode() {
        const mode = document.getElementById('inputMode').value;
        document.getElementById('separateInputs').style.display = mode === 'separate' ? 'block' : 'none';
        document.getElementById('commaInput').style.display     = mode === 'comma'    ? 'block' : 'none';
    }

    document.getElementById('calcForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const mode      = document.getElementById('inputMode').value;
        const operation = document.getElementById('operation').value;
        let a, b;

        // Adapter web: parsea según el modo elegido por el usuario
        // Equivale a StringToDoubleAdapter o campos directos según selección
        if (mode === 'comma') {
            const raw = document.getElementById('fieldComma').value.trim();
            const parts = raw.split(',');
            if (parts.length !== 2) {
                document.getElementById('output').innerHTML =
                    '<div class="result"><span class="label">Error</span>' +
                    '<span class="value">Formato inválido. Usa: 3.5,2</span></div>';
                return;
            }
            a = parseFloat(parts[0].trim());
            b = parseFloat(parts[1].trim());
        } else {
            a = parseFloat(document.getElementById('fieldA').value);
            b = parseFloat(document.getElementById('fieldB').value);
        }

        // Validación de división por cero antes de enviar
        if (operation === 'division' && b === 0) {
            document.getElementById('output').innerHTML =
                '<div class="result"><span class="label">Error</span>' +
                '<span class="value">No se puede dividir entre cero</span></div>';
            return;
        }

        const params = new URLSearchParams({ a, b, operation });
        const response = await fetch('/calculate', {
            method: 'POST',
            body: params
        });

        document.getElementById('output').innerHTML = await response.text();
    });
</script>
</body>
</html>