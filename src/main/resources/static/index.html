<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Calculadora</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="card">
    <h1>Calculadora</h1>
    <form id="calcForm">

        <!-- Modo de entrada — activa el adapter correspondiente en el backend -->
        <div class="field">
            <label>Modo de entrada</label>
            <select name="inputMode" id="inputMode" onchange="toggleMode()">
                <option value="string">Decimal (ej: 3.5,2)</option>
                <option value="integer">Entero (ej: 4,7)</option>
            </select>
        </div>

        <!-- Campo único "operands" — lo que el controller espera -->
        <div class="field">
            <label id="operandsLabel">Operandos (separados por coma)</label>
            <input type="text"
                   name="operands"
                   id="operands"
                   placeholder="3.5,2"
                   required>
            <small id="hint" style="color:#888">Dos números separados por coma</small>
        </div>

        <div class="field">
            <label>Operación</label>
            <select name="operation">
                <option value="add">Suma</option>
                <option value="subtract">Resta</option>
                <option value="multiplication">Multiplicación</option>
                <option value="division">División</option>
                <option value="legacy-add">Suma (legacy)</option>
            </select>
        </div>

        <button type="submit">Calcular</button>
    </form>

    <div id="output"></div>
</div>

<script>
    function toggleMode() {
        const mode  = document.getElementById('inputMode').value;
        const hint  = document.getElementById('hint');
        const input = document.getElementById('operands');

        if (mode === 'integer') {
            hint.textContent  = 'Dos enteros separados por coma. Ej: 4,7';
            input.placeholder = '4,7';
        } else {
            hint.textContent  = 'Dos decimales separados por coma. Ej: 3.5,2';
            input.placeholder = '3.5,2';
        }
    }

    document.getElementById('calcForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const form   = new FormData(e.target);
        const params = new URLSearchParams(form);

        // Validación básica del formato antes de enviar
        const operands = form.get('operands').trim();
        const parts    = operands.split(',');
        if (parts.length !== 2 || parts.some(p => p.trim() === '')) {
            document.getElementById('output').innerHTML =
                '<div class="result"><span class="label">Error</span>' +
                '<span class="value">Formato inválido. Usa: número,número (ej: 3.5,2)</span></div>';
            return;
        }

        const response = await fetch('/calculate', {
            method: 'POST',
            body: params
        });

        document.getElementById('output').innerHTML = await response.text();
    });
</script>
</body>
</html>